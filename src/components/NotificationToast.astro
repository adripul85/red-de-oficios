---
/**
 * NotificationToast.astro
 * A premium global notification system for DeOficios.
 * Exposes window.showNotification(title, message, type, duration)
 */
---

<div id="notification-container" class="fixed top-5 right-5 z-[99999] flex flex-col gap-4 pointer-events-none max-w-sm w-full px-4 sm:px-0">
</div>

<template id="notification-template">
    <div class="notification-item transform translate-x-12 opacity-0 bg-white/80 backdrop-blur-xl border border-white/20 shadow-[0_20px_40px_rgba(0,0,0,0.1)] p-5 rounded-[2rem] flex items-start gap-4 pointer-events-auto transition-all duration-500 hover:scale-[1.02] active:scale-[0.98] cursor-pointer group">
        <div class="icon-container w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 shadow-inner group-hover:rotate-6 transition-transform">
            <span class="material-symbols-outlined text-2xl"></span>
        </div>
        <div class="flex-1 overflow-hidden">
            <h4 class="notification-title font-extrabold text-slate-900 text-sm tracking-tight mb-0.5 truncate"></h4>
            <p class="notification-message text-slate-500 text-xs leading-relaxed line-clamp-2"></p>
        </div>
        <button class="close-btn text-slate-300 hover:text-slate-900 shrink-0 transition-colors">
            <span class="material-symbols-outlined text-sm">close</span>
        </button>
    </div>
</template>

<script>
    function setupNotifications() {
        const container = document.getElementById('notification-container');
        const template = document.getElementById('notification-template') as HTMLTemplateElement;

        if (!container || !template) return;

        window.showNotification = (title, message, type = 'success', duration = 5000) => {
            const clone = template.content.cloneNode(true) as HTMLElement;
            const item = clone.querySelector('.notification-item') as HTMLElement;
            const titleEl = clone.querySelector('.notification-title');
            const messageEl = clone.querySelector('.notification-message');
            const iconContainer = clone.querySelector('.icon-container');
            const iconSpan = clone.querySelector('.icon-container span');
            const closeBtn = clone.querySelector('.close-btn');

            if (titleEl) titleEl.textContent = title;
            if (messageEl) messageEl.textContent = message;

            // Type styles
            const styles = {
                success: {
                    bg: 'bg-green-50',
                    text: 'text-green-600',
                    icon: 'check_circle'
                },
                error: {
                    bg: 'bg-red-50',
                    text: 'text-red-600',
                    icon: 'error'
                },
                info: {
                    bg: 'bg-blue-50',
                    text: 'text-blue-600',
                    icon: 'info'
                },
                warning: {
                    bg: 'bg-amber-50',
                    text: 'text-amber-600',
                    icon: 'warning'
                }
            };

            const style = styles[type] || styles.success;
            if (iconContainer) iconContainer.classList.add(style.bg);
            if (iconSpan) {
                iconSpan.classList.add(style.text);
                iconSpan.textContent = style.icon;
            }

            container.appendChild(clone);

            // Animate In: Wait a tiny bit for the DOM to render the item
            const actualItem = container.lastElementChild as HTMLElement;
            setTimeout(() => {
                actualItem.classList.remove('translate-x-12', 'opacity-0');
            }, 10);

            const close = () => {
                actualItem.classList.add('translate-x-12', 'opacity-0', 'scale-90');
                setTimeout(() => actualItem.remove(), 500);
            };

            if (closeBtn) closeBtn.onclick = close;
            actualItem.onclick = close;

            if (duration > 0) {
                setTimeout(close, duration);
            }
        };
    }

    // Initialize on page load
    document.addEventListener('astro:page-load', setupNotifications);
    // Also run immediately in case of hard refresh
    setupNotifications();
</script>

<style>
    .notification-item {
        transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
</style>
