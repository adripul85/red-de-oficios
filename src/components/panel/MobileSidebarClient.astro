---
const { currentPath } = Astro.props;

const menuItems = [
    { path: "/mi-cuenta", icon: "ðŸ ", label: "Inicio" },
    { path: "/resultados", icon: "ðŸ”", label: "Buscar Oficios" },
];

const isActive = (path) => {
    if (path === "/mi-cuenta" && currentPath === "/mi-cuenta") return true;
    if (path !== "/mi-cuenta" && currentPath.startsWith(path)) return true;
    return false;
};
---

<aside
    id="mobile-sidebar-client"
    class="md:hidden fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 border-r border-slate-800 flex flex-col transform -translate-x-full transition-transform duration-300"
>
    <div class="h-16 flex items-center justify-between px-6 border-b border-slate-800">
        <a href="/" class="text-xl font-bold text-white">
            DeOficios<span class="text-blue-500">Club</span>
        </a>
        <button id="close-sidebar-client" class="text-2xl text-gray-400 hover:text-white">âœ•</button>
    </div>

    <div class="flex-1 overflow-y-auto py-4">
        <nav class="px-3 space-y-1">
            {
                menuItems.map((item) => (
                    <a
                        href={item.path}
                        class:list={[
                            "flex items-center gap-3 px-3 py-2.5 rounded-lg group transition-colors relative",
                            isActive(item.path)
                                ? "bg-blue-900/20 text-blue-400"
                                : "text-gray-400 hover:bg-slate-800 hover:text-white",
                        ]}
                    >
                        <span class="text-xl">{item.icon}</span>
                        <span class={isActive(item.path) ? "font-semibold text-sm" : "font-medium text-sm"}>
                            {item.label}
                        </span>
                    </a>
                ))
            }
        </nav>
    </div>

    <div class="p-4 border-t border-slate-800">
        <button
            id="btn-logout-mobile-client"
            class="flex items-center gap-3 px-3 py-2 w-full text-gray-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors text-left"
        >
            <span>ðŸšª</span>
            <span class="font-medium text-sm">Cerrar SesiÃ³n</span>
        </button>
    </div>
</aside>

<div
    id="sidebar-overlay-client"
    class="sidebar-overlay fixed inset-0 bg-black/50 z-40 hidden opacity-0 transition-opacity duration-300 md:hidden"
>
</div>

<script>
    import { auth } from "../../firebase/client";
    import { signOut } from "firebase/auth";

    function setupMobileSidebarClient() {
        const mobileSidebar = document.getElementById("mobile-sidebar-client");
        const sidebarOverlay = document.getElementById("sidebar-overlay-client");
        const openSidebarBtns = document.querySelectorAll("#open-sidebar");
        const closeSidebarBtn = document.getElementById("close-sidebar-client");
        const logoutBtnMobile = document.getElementById("btn-logout-mobile-client");

        if (!mobileSidebar) return;

        function openMobileSidebar(e) {
            e?.preventDefault();
            e?.stopPropagation();
            mobileSidebar.classList.remove("-translate-x-full");
            if (sidebarOverlay) {
                sidebarOverlay.classList.remove("hidden");
                requestAnimationFrame(() => {
                    sidebarOverlay.classList.remove("opacity-0");
                    sidebarOverlay.classList.add("opacity-100");
                });
            }
        }

        function closeMobileSidebar(e) {
            e?.preventDefault();
            mobileSidebar.classList.add("-translate-x-full");
            if (sidebarOverlay) {
                sidebarOverlay.classList.remove("opacity-100");
                sidebarOverlay.classList.add("opacity-0");
                setTimeout(() => {
                    sidebarOverlay.classList.add("hidden");
                }, 300);
            }
        }

        openSidebarBtns.forEach((btn) => (btn.onclick = openMobileSidebar));
        if (closeSidebarBtn) closeSidebarBtn.onclick = closeMobileSidebar;
        if (sidebarOverlay) sidebarOverlay.onclick = closeMobileSidebar;

        if (logoutBtnMobile) {
            logoutBtnMobile.onclick = async (e) => {
                e.preventDefault();
                try {
                    await signOut(auth);
                    window.location.href = "/ingresar";
                } catch (error) {
                    console.error("Error al cerrar sesiÃ³n:", error);
                }
            };
        }
    }

    setupMobileSidebarClient();
    document.addEventListener("astro:page-load", setupMobileSidebarClient);
</script>
