---
import { CATEGORIES } from "../../data/categories";
import {
  Droplets,
  Zap,
  Flame,
  Key,
  Wrench,
  Snowflake,
  Plug,
  BrickWall,
  PaintRoller,
  Home,
  Hammer,
  Scissors,
  Flower2,
  Waves,
  Sofa,
  Shirt,
  Footprints,
  Clock,
  Settings,
  Cake,
  Gift,
  Music,
  Truck,
  Bug,
  User,
  Search,
  Video,
  Laptop,
  Grid,
} from "lucide-astro";

// 1. Mapa de Componentes Lucide
const componentMap: Record<string, any> = {
  // Urgencias
  Plomero: Droplets,
  Electricista: Zap,
  Gasista: Flame,
  Cerrajero: Key,
  Destapaciones: Wrench,
  "Técnico de Aire Acondicionado": Snowflake,
  "Técnico de Electrodomésticos": Plug,
  // Construcción
  Albañil: BrickWall,
  Pintor: PaintRoller,
  Techista: Home,
  "Colocador de Pisos/Ceramista": Grid,
  Durlockero: Hammer,
  Herrero: Settings, // No exact anvil, using Settings/Cog or Hammer
  Carpintero: Hammer,
  Vidriero: Grid,
  // Mantenimiento
  Jardinero: Flower2,
  Piletero: Waves,
  Persianista: Grid,
  Tapicero: Sofa,
  "Sastre / Modista": Shirt,
  Zapatero: Footprints,
  Relojero: Clock,
  Matricero: Settings,
  // Eventos
  "Pastelero/a": Cake,
  Souvenirs: Gift,
  "DJ / Sonido": Music,
  Fletero: Truck,
  Fumigador: Bug,
  // Estética
  "Peinador / Estilista": Scissors,
  Barbero: Scissors,
  "Maquillador / Maquilladora": User,
  "Manicura / Pedicura": User,
  // Seguridad
  "Instalador de Cámaras de Seguridad": Video,
  "Técnico de PC / Celulares": Laptop,
  default: Wrench,
};

// 2. Aplanar lista completa
const allRubros = CATEGORIES.flatMap((grupo) =>
  grupo.trades.map((trade) => ({
    name: trade.name,
    slug: trade.name,
    Icon: componentMap[trade.name] || componentMap["default"], // Capital Icon for component
  })),
);

// 3. Randomness en Servidor (Build Time o SSR)
const shuffled = [...allRubros].sort(() => 0.5 - Math.random());
const randomCategories = shuffled.slice(0, 12);
---

<section class="quick-links-section">
  <div class="container">
    <h2 class="section-title">¿Qué estás buscando hoy?</h2>

    <div class="categories-grid">
      {
        randomCategories.map((cat) => (
          <a
            href={`/resultados?q=${encodeURIComponent(cat.slug)}`}
            class="category-card fade-in">
            <div class="icon-wrapper text-orange-600 mb-2">
              <cat.Icon class="w-8 h-8" />
            </div>
            <span class="name">{cat.name}</span>
          </a>
        ))
      }

      <a href="/resultados" class="category-card view-all fade-in">
        <div class="icon-wrapper text-orange-600 mb-2">
          <Search class="w-8 h-8" />
        </div>
        <span class="name">Ver todos<br />los rubros</span>
      </a>
    </div>
  </div>
</section>

<style>
  .quick-links-section {
    padding: 40px 0;
    background: #ffffff;
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .section-title {
    font-size: 1.5rem;
    color: #1f2937;
    margin-bottom: 25px;
    font-weight: 700;
  }

  .categories-grid {
    display: flex;
    overflow-x: auto;
    gap: 15px;
    padding: 10px 5px 20px 5px; /* Bottom padding for scrollbar hiding/spacing */
    scroll-snap-type: x mandatory;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
  }

  /* Hide scrollbar */
  .categories-grid::-webkit-scrollbar {
    display: none;
  }

  /* ESTILOS GLOBALES PARA ELEMENTOS INYECTADOS */
  :global(.category-card) {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 20px 10px;
    text-decoration: none;
    transition: all 0.2s ease;
    cursor: pointer;

    /* Mobile Fixed Width */
    min-width: 140px;
    flex-shrink: 0; /* IMPRESCINDIBLE PARA QUE NO SE ACHIQUEN */
    scroll-snap-align: start;

    height: 100%;
    min-height: 110px;
    animation: fadeIn 0.5s ease-in-out;
  }

  :global(.category-card:hover) {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
    border-color: #e67e22;
    background: white;
  }

  :global(.category-card .icon-wrapper) {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  :global(.category-card .name) {
    color: #4b5563;
    font-weight: 600;
    font-size: 0.85rem;
    text-align: center;
    line-height: 1.2;
  }

  :global(.view-all) {
    background: #fff7ed !important;
    border-color: #ffedd5 !important;
  }
  :global(.view-all .name) {
    color: #ea580c !important;
  }
  :global(.view-all:hover) {
    background: #ffedd5 !important;
    border-color: #ea580c !important;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(5px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (min-width: 768px) {
    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      overflow-x: visible;
      padding-bottom: 0;
    }

    :global(.category-card) {
      min-width: auto; /* Reset fixed width for grid */
    }
  }

  @media (max-width: 600px) {
    /* MANTENER FLEX EN MÓVIL (NO GRID) */
    .categories-grid {
      display: flex; /* Asegurar flex */
      gap: 10px;
      /* overflow-x already set in default */
    }

    :global(.category-card) {
      padding: 15px 5px;
      min-height: 90px;
      min-width: 110px; /* Reduced slightly */
      flex-shrink: 0;
    }
    :global(.category-card .name) {
      font-size: 0.7rem;
    }
  }
</style>
