---
// Recibir tendencias como prop desde index.astro
const { trends } = Astro.props;
import { Mic } from "lucide-astro";
import { Image } from "astro:assets";
import heroImage from "../../assets/hero-worker.jpg";

// --- TENDENCIAS ---
let trendingTags = trends || [];

// Si no se pasaron trends como prop, usar fallback
if (!trendingTags || trendingTags.length === 0) {
  trendingTags = [
    { term: "Plomero", link: "plomero" },
    { term: "Electricista", link: "electricista" },
    { term: "Pintor", link: "pintor" },
    { term: "Gasista", link: "gasista" },
    { term: "Albail", link: "albail" },
  ];
}
---

<!-- Hero Search Premium -->
<div
  class="relative w-full min-h-[85vh] md:min-h-[90vh] bg-white flex flex-col md:flex-row overflow-hidden font-sans">
  <!-- Mobile: Imagen arriba con onda -->
  <div class="md:hidden relative h-[250px] w-full">
    <div class="w-full h-full bg-gradient-to-r from-orange-100 to-orange-50">
    </div>
    <!-- Onda bottom -->
    <div class="absolute bottom-0 left-0 w-full">
      <svg
        viewBox="0 0 1200 120"
        preserveAspectRatio="none"
        class="w-full h-10">
        <path d="M0,120 L0,30 Q600,120 1200,30 L1200,120 Z" fill="#ffffff" />
      </svg>
    </div>
  </div>

  <!-- Contenido izquierdo -->
  <div
    class="w-full md:w-1/2 flex flex-col justify-center items-center px-6 md:px-20 py-8 md:py-12 z-10 bg-white -mt-12 md:-mt-20">
    <div class="w-full max-w-xl">
      <h1
        class="text-4xl md:text-6xl font-extrabold text-slate-900 mb-4 leading-tight">
        Encontr al <span class="text-orange-600">experto</span>
        <br /> que necesits.
      </h1>
      <p class="text-slate-500 text-lg mb-8">
        Plomeros, electricistas y ms de <strong>62.000 profesionales</strong> verificados.
      </p>

      <!-- Buscador Premium simplificado - Solo Servicio -->
      <form
        id="hero-search-form"
        action="/resultados"
        method="GET"
        class="bg-white border border-slate-200 rounded-full shadow-2xl p-2 flex items-center relative z-20 mb-6">
        <!-- Input: Servicio -->
        <div class="flex-1 w-full px-6 py-3 relative flex items-center">
         <div class="w-full">
            <label
                class="block text-xs font-bold text-slate-800 uppercase tracking-wide mb-1">
                Qu servicio necesits?
            </label>
            <input
                type="text"
                name="q"
                id="input-servicio"
                placeholder="Ej: Souvenirs, Electricista, Plomero..."
                class="w-full outline-none text-slate-700 placeholder-slate-400 bg-transparent text-lg pr-10"
                autocomplete="off"
            />
         </div>
          <button type="button" id="btn-mic" class="hidden absolute right-4 bottom-4 text-slate-400 hover:text-orange-500 transition-colors p-2" aria-label="Busqueda por voz">
            <Mic class="w-5 h-5" />
          </button>
        </div>

        <!-- Botn Buscar -->
        <button
          type="submit"
          class="bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white rounded-full p-4 md:p-3 transition-all active:scale-95 shadow-xl shadow-orange-200 flex items-center justify-center gap-2">
          <span class="text-2xl"></span>
          <span class="hidden md:inline font-bold text-lg">Buscar</span>
        </button>
      </form>

      <!-- Toggle 24hs + Tendencias -->
      <div class="flex flex-col md:flex-row md:items-center gap-6">
        <!-- Botn de Emergencia Real -->
        <a
          href="/solicitar?urgencia=true"
          class="group flex items-center gap-3 bg-red-50 hover:bg-red-100 border border-red-200 px-4 py-2 rounded-full transition-all cursor-pointer shadow-sm hover:shadow-red-100">
          <div class="relative">
            <div
              class="absolute inset-0 bg-red-500 rounded-full animate-ping opacity-20">
            </div>
            <span class="relative block text-2xl"></span>
          </div>
          <div class="flex flex-col">
            <span
              class="text-red-700 font-bold leading-none text-sm group-hover:text-red-800">BOTN DE EMERGENCIAS</span>
            <span
              class="text-[10px] text-red-500 font-semibold uppercase tracking-wider">Servicio 24hs</span>
          </div>
        </a>

        <!-- Tendencias -->
        <div class="flex items-center gap-2 flex-wrap">
          <span class="text-sm text-slate-500 font-medium">Tendencias:</span>
          {
            trendingTags.map((tag) => (
              <a
                href={`/resultados?q=${tag.link}`}
                class="px-3 py-1 bg-slate-100 hover:bg-orange-100 text-slate-700 hover:text-orange-700 text-sm font-medium rounded-full transition-all shadow-sm hover:shadow-md">
                {tag.term}
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Desktop: Imagen derecha con degradado -->
  <div class="hidden md:block w-1/2 h-auto relative">
    <Image
      src={heroImage}
      alt="Profesional trabajando"
      class="w-full h-full object-cover"
      loading="eager"
      fetchpriority="high"
    />
    <!-- Degradado sutil desde blanco -->
    <div
      class="absolute inset-0 bg-gradient-to-r from-white via-transparent to-transparent">
    </div>
  </div>

  <script>
    function initHeroSearch() {
      const form = document.getElementById("hero-search-form");
      const inputServicio = document.getElementById("input-servicio");
      const btnMic = document.getElementById("btn-mic");

      if (btnMic && inputServicio) {
        // @ts-ignore
        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;

        if (SpeechRecognition) {
          btnMic.classList.remove("hidden");
          // Clone to remove old listeners
          const newBtn = btnMic.cloneNode(true);
          btnMic.parentNode?.replaceChild(newBtn, btnMic);

          const recognition = new SpeechRecognition();
          recognition.continuous = false;
          recognition.lang = "es-AR";
          recognition.interimResults = false;
          recognition.maxAlternatives = 1;

          newBtn.addEventListener("click", (e) => {
            e.preventDefault();
            recognition.start();
            (newBtn as HTMLElement).classList.add(
              "text-orange-600",
              "animate-pulse",
            );
          });

          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            // @ts-ignore
            inputServicio.value = transcript;
            setTimeout(() => form?.submit(), 400);
          };

          recognition.onspeechend = () => {
            recognition.stop();
            (newBtn as HTMLElement).classList.remove(
              "text-orange-600",
              "animate-pulse",
            );
          };

          recognition.onerror = () => {
            (newBtn as HTMLElement).classList.remove(
              "text-orange-600",
              "animate-pulse",
            );
          };
        }
      }
    }

    // Init
    initHeroSearch();
    document.addEventListener("astro:page-load", initHeroSearch);
  </script>

  <style>
    /* Ocultar checkbox visualmente pero mantener accesibilidad */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
  </style>
</div>

