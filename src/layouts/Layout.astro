---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import IAFloatingButton from "../components/IAFloatingButton.astro";
import "../styles/global.css";
import { ClientRouter } from "astro:transitions";

interface Props {
	title: string;
	description?: string;
	image?: string;
	hideHeader?: boolean;
	hideFooter?: boolean;
	hideIA?: boolean;
}

const {
	title,
	description = "DeOficios - Conectando profesionales con vecinos. Encontrá al experto que necesitás o ofrecé tus servicios.",
	image = "/icon-512.png",
	hideHeader = false,
	hideFooter = false,
	hideIA = false,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!doctype html>
<html lang="es">
	<head>
		<script is:inline>
			// DARK MODE INIT - Prevents FOUC
			if (
				localStorage.theme === "dark" ||
				(!("theme" in localStorage) &&
					window.matchMedia("(prefers-color-scheme: dark)").matches)
			) {
				document.documentElement.classList.add("dark");
			} else {
				document.documentElement.classList.remove("dark");
			}
		</script>
		<!-- Google tag (gtag.js) -->
		<script
			async
			src="https://www.googletagmanager.com/gtag/js?id=G-LG6RPRWWDY"
		></script>
		<script is:inline>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag("js", new Date());

			gtag("config", "G-LG6RPRWWDY");
		</script>

		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
		/>
		<meta name="description" content={description} />
		<link rel="canonical" href={canonicalURL} />
		<link rel="icon" type="image/png" href="/icon-192.png" />
		<link rel="manifest" href="/manifest.json" />
		<meta name="theme-color" content="#ea580c" />

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={canonicalURL} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={new URL(image, Astro.url)} />

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image" />
		<meta property="twitter:url" content={canonicalURL} />
		<meta property="twitter:title" content={title} />
		<meta property="twitter:description" content={description} />
		<meta property="twitter:image" content={new URL(image, Astro.url)} />

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			rel="stylesheet"
			href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
		/>

		<!-- Preload critical fonts for faster rendering -->
		<link
			rel="preload"
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700&display=swap"
			as="style"
			onload="this.onload=null;this.rel='stylesheet'"
		/>
		<noscript>
			<link
				href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700&display=swap"
				rel="stylesheet"
			/>
		</noscript>

		<title>{title}</title>
		<ClientRouter />

		<!-- SweetAlert2 -->
		<script is:inline src="https://cdn.jsdelivr.net/npm/sweetalert2@11"
		></script>
	</head>
	<body
		class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300"
	>
		<!-- PREMIUM SPLASH SCREEN (Apple Music Style) -->
		<div id="custom-splash-screen">
			<img
				src="/icon-512.png"
				alt="Logo DeOficios"
				width="280"
				height="280"
			/>
		</div>

		{!hideHeader && <Header />}
		<slot />
		{!hideFooter && <Footer />}

		<!-- Splash Screen Script -->
		<script is:inline>
			// Hide splash screen on first load AND on every View Transition
			function hideSplash() {
				const splash = document.getElementById("custom-splash-screen");
				if (splash && !splash.classList.contains("hidden")) {
					splash.classList.add("hidden");
					setTimeout(() => splash.remove(), 400);
				}
			}

			// First load
			document.addEventListener("DOMContentLoaded", () => {
				setTimeout(() => hideSplash(), 300);
			});

			// View Transitions navigations
			document.addEventListener("astro:page-load", () => {
				hideSplash();
			});
		</script>

		<script is:inline>
			if ("serviceWorker" in navigator) {
				window.addEventListener("load", () => {
					navigator.serviceWorker
						.register("/sw.js")
						.then((reg) =>
							console.log(
								"✅ Service Worker registrado:",
								reg.scope,
							),
						)
						.catch((err) =>
							console.log("❌ Error registro SW:", err),
						);
				});
			}
		</script>
	</body>
</html>

<style is:global>
	/* ========== PREMIUM SPLASH SCREEN (Apple Music Style) ========== */
	#custom-splash-screen {
		/* Cover entire screen and stay on top */
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100vh;
		height: 100dvh; /* Dynamic viewport height for mobile */
		z-index: 99999;

		/* Center the logo */
		display: flex;
		justify-content: center;
		align-items: center;

		/* Apple Music style background with gradient fades */
		background-color: #ea580c; /* Orange brand color */

		/* Two overlapping gradients for white fades at top and bottom */
		background-image:
			linear-gradient(
				to bottom,
				rgba(255, 255, 255, 0.3) 0%,
				rgba(255, 255, 255, 0) 25%
			),
			linear-gradient(
				to top,
				rgba(255, 255, 255, 0.3) 0%,
				rgba(255, 255, 255, 0) 25%
			);

		/* Smooth fade-out animation */
		transition:
			opacity 0.5s ease-out,
			visibility 0.5s;
	}

	#custom-splash-screen img {
		/* Logo styling */
		border-radius: 24px;
		box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
		animation: pulse-glow 1.5s ease-in-out infinite alternate;
	}

	@keyframes pulse-glow {
		from {
			transform: scale(1);
			box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
		}
		to {
			transform: scale(1.05);
			box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
		}
	}

	/* Hidden state for fade-out */
	#custom-splash-screen.hidden {
		opacity: 0;
		visibility: hidden;
		pointer-events: none;
	}

	/* ========== CSS VARIABLES ========== */
	:root {
		--primary: #a34320;
		--bg-light: #f9fafb;
		--font-body: "Inter", sans-serif;
		--font-heading: "Montserrat", sans-serif;
	}
	/*:root {
	original:#ea580c
		--color-primary: #bf4f26;
		--color-primary-dark: #a34320;
		--color-deep-black: #1a1a1a;
		--color-off-white: #ffffff;
		--color-light-gray: #f9f9f9;
		--color-medium-gray: #555555;
		--color-border-gray: #e5e7eb;
	}*/
	html {
		font-family: var(--font-body);
		background: #ffffff;
		scroll-behavior: smooth;
	}
	body {
		margin: 0;
		min-height: 100vh;
		display: flex;
		flex-direction: column;
		overflow-x: hidden;
	}
	main {
		flex: 1;
		width: 100%;
		display: flex;
		flex-direction: column;
	}
	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		font-family: var(--font-heading);
	}
	*,
	*::before,
	*::after {
		box-sizing: border-box;
	}
	img {
		max-width: 100%;
		height: auto;
		display: block;
	}
</style>
<script>
	// Evitar click derecho
	document.addEventListener("contextmenu", (event) => event.preventDefault());

	// Evitar atajos de teclado para ver código (F12, Ctrl+U, etc)
	document.onkeydown = function (e: KeyboardEvent) {
		if (e.keyCode == 123) {
			return false;
		} // F12
		if (e.ctrlKey && e.shiftKey && e.keyCode == "I".charCodeAt(0)) {
			return false;
		} // Ctrl+Shift+I
		if (e.ctrlKey && e.shiftKey && e.keyCode == "C".charCodeAt(0)) {
			return false;
		} // Ctrl+Shift+C
		if (e.ctrlKey && e.shiftKey && e.keyCode == "J".charCodeAt(0)) {
			return false;
		} // Ctrl+Shift+J
		if (e.ctrlKey && e.keyCode == "U".charCodeAt(0)) {
			return false;
		} // Ctrl+U
	};
</script>
